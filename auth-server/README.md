# Spring Boot Auth Server, used Github as the authentication source.

There are two apps in this project.

## secure-service:
- spring-security is enabled for this microservice and all endpoints will be authenticated using oauth token.
- It has **tollData** service which will be consumed by UI microservice.
- Services can only be consumed by passing token in Authorization header provided by Github authorization server (obtained in secure-ui service).
- Token will be authenticated by github using the url mentioned in application.properties.

## secure-ui:
- spring-security is enabled for this microservice and all endpoints will be authenticated using oauth token.
- oAuth token will be generated using Github authorization server.
- oAuth token generated by Github authorization server will be passed as Authorization header to consume **secure-service** api's.
- Below steps can enable oAuth generation automatically in spring boot app.
  - Add ```spring-boot-starter-security``` and ```spring-cloud-starter-oauth2``` as dependencies in pom.xml.
  - Add annotation ```@EnableOAuth2Sso``` in SpringbootApplication class.
  - Add below properties in application.properties file, below properties will work only on application which runs on localhost:8080, so they cannot be used for production.
    ```
    security.oauth2.client.client-id=bd1c0a783ccdd1c9b9e4
    security.oauth2.client.client-secret=1a9030fbca47a5b2c28e92f19050bb77824b5ad1
    security.oauth2.client.access-token-uri=https://github.com/login/oauth/access_token
    security.oauth2.client.user-authorization-uri=https://github.com/login/oauth/authorize
    security.oauth2.client.client-authentication-scheme=form
    security.oauth2.resource.user-info-uri=https://api.github.com/user
    security.oauth2.resource.prefer-token-info=false
    ```
    
## Architecute Explanation.

![auth-architecure](auth.png)
   
1. Browser makes a request to secure-ui app using url "localhost:8080/login".
2. secure-ui app checks the configuration to authenticate request, identifies oAuth is enabled, checks the properties file and redirect response with url https://github.com/login/oauth/authorize along with client_id, redirect_uri, response_type and state values.
3. Now Github login page is opened in user's browser window where user enters its credentials, provides consent and click on login button. Request with login details goes to Github server.
4. Github validates the auth request, and if credentials are correct then git server sends a redirection response with url http://locahost:8080/login along with  **Authorization Grant** to the browser. Redirection url is same which is given as a redirect_uri in step number 2. This url should also be registered with Github or any other service provider which is used for Oauth authentication. URL localhost:8080/login is not required to be registered as this will be only used for developement.
5. Now browser send request to localhost:8080/login along with code(authoriation grant) and state parameters.
6. Now secure-ui receives the request, makes call to github server (url given in property security.oauth2.client.access-token-uri) and provides authorization-grant, client-id and client-secret (available in properties file) in request.
7. Github validates all the details received in a request, if all details are correct then it generates and return an authorization token in response.
8. secure-ui app receives authorization token and stores it to the session and sends redirection response with url localhost:8080 to the browser. Now browser dispalys the home page in the broswer. ** Authentication at this point is completed **.
